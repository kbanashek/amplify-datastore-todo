---
description: Unit testing requirements and patterns
alwaysApply: true
globs: ["**/*.test.ts", "**/*.test.tsx", "**/__tests__/**/*"]
---

# Testing

## Unit Testing Requirements

- **ALWAYS create unit tests** for any new hooks, services, and components
- **Test files must be created alongside the source files** - not as an afterthought
- **Test file naming convention:**
  - Hooks: `src/hooks/__tests__/useHookName.test.ts`
  - Services: `src/services/__tests__/ServiceName.test.ts`
  - Components: `src/components/__tests__/ComponentName.test.tsx` or `src/components/[category]/__tests__/ComponentName.test.tsx`
- **Test coverage requirements:**
  - **Hooks**: Test all return values, state changes, side effects, and edge cases
  - **Services**: Test all public methods, error handling, and data transformations
  - **Components**: Test rendering, user interactions, props handling, and conditional rendering
- **Testing patterns:**
  - Use Jest and React Testing Library for all tests
  - Mock external dependencies (DataStore, APIs, AsyncStorage, etc.)
  - Test user interactions (clicks, input changes, form submissions)
  - Test error states and loading states
  - Test edge cases (empty data, null values, invalid inputs)
- **When creating new code:**
  1. Create the hook/service/component/utility
  2. **IMMEDIATELY create the corresponding test file** - tests are REQUIRED, not optional
  3. Write tests covering the main functionality
  4. Ensure tests pass before considering the feature complete
- **When refactoring or moving code:**
  1. **ALWAYS update or create unit tests** for moved/refactored code
  2. Update test file paths to match new locations
  3. Update test imports to reflect new module structure
  4. Ensure all existing tests still pass after the move
  5. Add new tests if functionality changes during refactoring
  6. **NO EXCEPTIONS** - refactoring without updating tests is incomplete
- **CRITICAL: ALL new files must have unit tests**
  - **Hooks**: `src/hooks/__tests__/useHookName.test.ts`
  - **Components**: `src/components/__tests__/ComponentName.test.tsx` or `src/components/[category]/__tests__/ComponentName.test.tsx`
  - **Services**: `src/services/__tests__/ServiceName.test.ts`
  - **Utils**: `src/utils/__tests__/utilityName.test.ts`
  - **NO EXCEPTIONS** - if you create a new file, you MUST create its test file immediately
- **Examples:**
  - ✅ Good: Create `src/hooks/useAppointmentList.ts` → Create `src/hooks/__tests__/useAppointmentList.test.ts` immediately
  - ✅ Good: Create `src/services/AppointmentService.ts` → Create `src/services/__tests__/AppointmentService.test.ts` immediately
  - ✅ Good: Create `src/components/AppointmentCard.tsx` → Create `src/components/__tests__/AppointmentCard.test.tsx` immediately
  - ❌ Bad: Create hook/service/component without corresponding test file
  - ❌ Bad: "I'll add tests later" - tests must be created with the code
- **Test structure:**
  - Use `describe` blocks to group related tests
  - Use descriptive test names that explain what is being tested
  - Follow Arrange-Act-Assert pattern
  - Clean up after tests (clear mocks, reset state, etc.)
- **Required test scenarios:**
  - **Hooks**: Initial state, state updates, side effects, cleanup, error handling
  - **Services**: Method calls, return values, error cases, edge cases (empty arrays, null values)
  - **Components**: Rendering with props, user interactions, conditional rendering, error states, loading states
